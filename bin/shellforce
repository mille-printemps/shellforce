#!/usr/bin/env ruby
# conding : utf-8

$:.unshift File.dirname(__FILE__) + "/../lib"

require 'rubygems'
require 'shellforce/client'
require 'shellforce/command'

include ShellForce::Command

class Object
  def local_methods
    self.methods.sort - self.class.superclass.methods
  end
end

def client
  @client ||= ShellForce::Client.new
end

puts "Initializing..."
client

config = ARGV.empty? ? :default : ARGV[0]
ShellForce.config.use config

CLIENT = client.local_methods
CLIENT.each do |m|
    eval <<-METHOD
def #{m}(*args, &block)
  begin
    client.#{m}(*args, &block)
  rescue StandardError
    puts $!
  end
end
    METHOD
end

require 'irb'
require 'irb/completion'

irbrc = File.join(ENV["HOME"], ".irbrc")
if File.exists? irbrc
    ENV["IRBRC"] = irbrc
end

ARGV.clear

IRB.start

exit!

