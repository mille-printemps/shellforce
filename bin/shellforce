#!/usr/bin/env ruby
# conding : utf-8

$:.unshift File.dirname(__FILE__) + "/../lib"

require 'rubygems'
require 'json'
require 'shellforce/client'

VERBS = ['get', 'post', 'delete', 'patch', 'query', 'search']

def client
  @client ||= ShellForce::Client.new
end

puts "Initialing..."
client

config = ARGV.empty? ? :default : ARGV[0]
ShellForce.config.use config

VERBS.each do |m|
    eval <<-METHOD
def #{m}(*args, &block)
  begin
    client.#{m}(*args, &block)
  rescue StandardError
    puts $!
  end
end
    METHOD
end

def instance_url
  client.instance_url
end

def token
  client.token
end

def pid
  client.pid
end

def pr(response)
  puts JSON.pretty_generate(response[0])
  puts "%s seconds" % response[1]
end
 
require 'irb'
require 'irb/completion'

if File.exists? ".irbrc"
    ENV['IRBRC'] = ".irbrc"
end

ARGV.clear

IRB.start

IRB.conf[:AT_EXIT] ||= []
IRB.conf[:AT_EXIT] << Proc.new{client.shutdown}

exit!
