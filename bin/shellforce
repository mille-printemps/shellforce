#!/usr/bin/env ruby
# conding : utf-8

$:.unshift File.dirname(__FILE__) + "/../lib"

require 'rubygems'
require 'shellforce/client'
require 'shellforce/command'

class Object
  def local_methods
    self.methods.sort - self.class.superclass.methods
  end
end

def client
  @client ||= ShellForce::Client.new
end

def command
  @command ||= ShellForce::Command.new
end

puts "Initializing..."
client
command

config = ARGV.empty? ? :default : ARGV[0]
ShellForce.config.use config

CLIENT = client.local_methods
CLIENT.each do |m|
    eval <<-METHOD
def #{m}(*args, &block)
  begin
    client.#{m}(*args, &block)
  rescue StandardError
    puts $!
  end
end
    METHOD
end

COMMAND = command.local_methods
COMMAND.each do |m|
    eval <<-METHOD
def #{m}(*args, &block)
  begin
    command.#{m}(*args, &block)
  rescue StandardError
    puts $!
  end
end
    METHOD
end

require 'irb'
require 'irb/completion'

if File.exists? ".irbrc"
    ENV['IRBRC'] = ".irbrc"
end

ARGV.clear

IRB.start

=begin
IRB.conf[:AT_EXIT] ||= []
IRB.conf[:AT_EXIT] << Proc.new{shutdown}
=end

exit!
